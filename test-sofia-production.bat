@echo off
echo.
echo ===================================
echo üåê TESTE QR CODES PRODU√á√ÉO SOFIA IA
echo ===================================
echo.
echo üîç Testando API em produ√ß√£o...
echo URL: https://sofia-api.roilabs.com.br
echo.

REM Definir vari√°veis
set API_URL=https://sofia-api.roilabs.com.br
set INSTANCE_NAME=teste-producao-%RANDOM%

echo ============================================
echo üì° 1. VERIFICANDO STATUS DA API...
echo ============================================
curl -s "%API_URL%/health" | jq "."
if %ERRORLEVEL% NEQ 0 (
    echo ‚ùå Erro ao conectar com API de produ√ß√£o!
    pause
    exit /b 1
)

echo.
echo ============================================
echo üì± 2. CRIANDO INST√ÇNCIA WHATSAPP...
echo ============================================
curl -s -X POST "%API_URL%/api/whatsapp/instances" ^
     -H "Content-Type: application/json" ^
     -d "{\"instanceName\":\"%INSTANCE_NAME%\",\"settings\":{\"rejectCall\":true,\"groupsIgnore\":true}}" | jq "."

echo.
echo ============================================
echo üì± 3. OBTENDO QR CODE REAL...
echo ============================================
echo ‚è≥ Aguardando QR code via webhook (pode demorar at√© 15s)...
timeout /t 5 /nobreak >nul
curl -s "%API_URL%/api/whatsapp/qrcode/%INSTANCE_NAME%" | jq "."

echo.
echo ============================================
echo üìä 4. VERIFICANDO ESTAT√çSTICAS...
echo ============================================
curl -s "%API_URL%/api/whatsapp/stats" | jq "."

echo.
echo ============================================
echo üîç 5. DEBUG QR CODES EM CACHE...
echo ============================================
curl -s "%API_URL%/api/debug/qr-cache" | jq "."

echo.
echo ‚úÖ TESTE CONCLU√çDO COM PRODU√á√ÉO
echo Inst√¢ncia criada: %INSTANCE_NAME%
echo.
pause